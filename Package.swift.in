// swift-tools-version:5.3

import PackageDescription

let package = Package(
    name: "Open3D-iOS",
    products: [
        .library(
            name: "Open3D-iOS",
            targets: [
                "LinkOpen3D",
                "Open3DSupport",
                "Assimp",
                "JPEG",
                "jsoncpp",
                "libOpen3D_3rdparty_liblzf.a",
                "libOpen3D_3rdparty_qhull_r.a",
                "libOpen3D_3rdparty_qhullcpp.a",
                "libOpen3D_3rdparty_rply.a",
                "libOpen3D.a",
                "png",
                "pybind.a",
                "TBB",
                // "libvtkCommonComputationalGeometry",
                "libvtkCommonDataModel",
                "libvtkCommonMath",
                "libvtkCommonExecutionModel",
                "libvtkCommonMisc",
                "libvtkCommonSystem",
                "libvtkCommonCore",
                "libvtkCommonTransforms",
                "libvtkFiltersCore",
                "libvtkFiltersGeneral",
                "libvtkFiltersModeling",
                "libvtkFiltersSources",
                "libvtkfmt",
                // "libvtkkissfft",
                "libvtkpugixml",
                "libvtksys",
                "libUVAtlas",
            ]),
    ],
    dependencies: [
        .package(url: "https://github.com/kewlbear/NumPy-iOS.git", .branch("main")),
        .package(url: "https://github.com/kewlbear/LAPACKE-iOS.git", .branch("main")),
        .package(url: "https://github.com/kewlbear/BLAS-LAPACK-AppStore-Workaround.git", .branch("main")),
    ],
    targets: [
        .binaryTarget(name: "Assimp", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/Assimp.xcframework.zip", checksum: "Assimp.xcframework_CHECKSUM"),
        .binaryTarget(name: "JPEG", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/JPEG.xcframework.zip", checksum: "JPEG.xcframework_CHECKSUM"),
        .binaryTarget(name: "jsoncpp", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/jsoncpp.xcframework.zip", checksum: "jsoncpp.xcframework_CHECKSUM"),
        .binaryTarget(name: "libOpen3D_3rdparty_liblzf.a", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/libOpen3D_3rdparty_liblzf.a.xcframework.zip", checksum: "libOpen3D_3rdparty_liblzf.a.xcframework_CHECKSUM"),
        .binaryTarget(name: "libOpen3D_3rdparty_qhull_r.a", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/libOpen3D_3rdparty_qhull_r.a.xcframework.zip", checksum: "libOpen3D_3rdparty_qhull_r.a.xcframework_CHECKSUM"),
        .binaryTarget(name: "libOpen3D_3rdparty_qhullcpp.a", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/libOpen3D_3rdparty_qhullcpp.a.xcframework.zip", checksum: "libOpen3D_3rdparty_qhullcpp.a.xcframework_CHECKSUM"),
        .binaryTarget(name: "libOpen3D_3rdparty_rply.a", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/libOpen3D_3rdparty_rply.a.xcframework.zip", checksum: "libOpen3D_3rdparty_rply.a.xcframework_CHECKSUM"),
        .binaryTarget(name: "libOpen3D.a", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/libOpen3D.a.xcframework.zip", checksum: "libOpen3D.a.xcframework_CHECKSUM"),
        .binaryTarget(name: "png", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/png.xcframework.zip", checksum: "png.xcframework_CHECKSUM"),
        .binaryTarget(name: "pybind.a", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/pybind.a.xcframework.zip", checksum: "pybind.a.xcframework_CHECKSUM"),
        .binaryTarget(name: "TBB", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/TBB.xcframework.zip", checksum: "TBB.xcframework_CHECKSUM"),
        // .binaryTarget(name: "libvtkCommonComputationalGeometry", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_Common_Computational.xcframework.zip", checksum: "VTK_Common_Computational.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkCommonDataModel", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_common_data_model.xcframework.zip", checksum: "VTK_common_data_model.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkCommonMath", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_common_math.xcframework.zip", checksum: "VTK_common_math.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkCommonExecutionModel", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_common_execution.xcframework.zip", checksum: "VTK_common_execution.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkCommonMisc", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_common_misc.xcframework.zip", checksum: "VTK_common_misc.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkCommonSystem", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_common_sys.xcframework.zip", checksum: "VTK_common_sys.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkCommonCore", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_common_core.xcframework.zip", checksum: "VTK_common_core.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkCommonTransforms", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_common_trans.xcframework.zip", checksum: "VTK_common_trans.xcframework_CHECKSUM"),
        
        .binaryTarget(name: "libvtkFiltersCore", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_filte_core.xcframework.zip", checksum: "VTK_filte_core.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkFiltersGeneral", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_filte_general.xcframework.zip", checksum: "VTK_filte_general.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkFiltersModeling", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_filte_model.xcframework.zip", checksum: "VTK_filte_model.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkFiltersSources", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_filte_src.xcframework.zip", checksum: "VTK_filte_src.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkfmt", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_fmt.xcframework.zip", checksum: "VTK_fmt.xcframework_CHECKSUM"),
        // .binaryTarget(name: "libvtkkissfft", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_kiss_fft.xcframework.zip", checksum: "VTK_kiss_fft.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtkpugixml", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_plugin_xml.xcframework.zip", checksum: "VTK_plugin_xml.xcframework_CHECKSUM"),
        .binaryTarget(name: "libvtksys", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/VTK_sys.xcframework.zip", checksum: "VTK_sys.xcframework_CHECKSUM"),
        .binaryTarget(name: "libUVAtlas", url: "https://github.com/windcludy/Open3D-iOS/releases/download/TAG/UVAtlas.xcframework.zip", checksum: "UVAtlas.xcframework_CHECKSUM"),
        .target(
            name: "LinkOpen3D",
            dependencies: [
                "NumPy-iOS",
                "LAPACKE-iOS",
                "Assimp",
                "JPEG",
                "jsoncpp",
                "libOpen3D_3rdparty_liblzf.a",
                "libOpen3D_3rdparty_qhull_r.a",
                "libOpen3D_3rdparty_qhullcpp.a",
                "libOpen3D_3rdparty_rply.a",
                "libOpen3D.a",
                "png",
                "pybind.a",
                "TBB",
                "BLAS-LAPACK-AppStore-Workaround",
                // "libvtkCommonComputationalGeometry",
                "libvtkCommonDataModel",
                "libvtkCommonMath",
                "libvtkCommonExecutionModel",
                "libvtkCommonMisc",
                "libvtkCommonSystem",
                "libvtkCommonCore",
                "libvtkCommonTransforms",
                "libvtkFiltersCore",
                "libvtkFiltersGeneral",
                "libvtkFiltersModeling",
                "libvtkFiltersSources",
                "libvtkfmt",
                // "libvtkkissfft",
                "libvtkpugixml",
                "libvtksys",
                "libUVAtlas",
            ],
            linkerSettings: [
                .linkedLibrary("stdc++"),
            ]
        ),
        .target(
            name: "Open3DSupport",
            resources: [.copy("site-packages")]),
        .testTarget(
            name: "Open3D-iOSTests",
            dependencies: ["Open3DSupport"]),
    ]
)
